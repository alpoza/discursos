---
title: "TextMining - Discursos Presidenciales tidy way"
author: "alpoza"
date: "6 de septiembre de 2017"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r libraries, message=FALSE, warning=FALSE}
require(tidyverse)
require(tidytext)
require(ggrepel)
require(tm)
```
```{r read_data, message=FALSE, warning=FALSE}
filenames <- list.files(".",pattern="*.txt")
discursos_raw = map(filenames,~readLines(.x,encoding="UTF-8")) %>% 
  map2(filenames, ~tibble(text=.x, docid=.y)) %>% 
  map_df(rbind)

# Replaces varios
discursos_raw = discursos_raw %>% 
  filter(text != "") %>% 
  mutate(text = gsub("SS.SS", "Sus_Señorías", text)
         ,text = gsub("SS. SS", "Sus_Señorías", text)
         )
discursos_raw 
```

```{r tyding, message=FALSE, warning=FALSE}
discursos = discursos_raw %>%     
  unnest_tokens(word, text) %>% 
  count(docid, word, sort = TRUE) %>%
  ungroup()

stop_words = data.frame(word=tm::stopwords("spanish"))
add.stops=c(
  "vez", "sino", "cada", "ello", "así", "sólo", "digo", 
  "que", "que,", "señorías","gobierno",
  "españa","españoles","país","ser","hacia","años",
  "debe","cualquier","año","manera","todas","mayor",
  "parte","presidenta","ustedes","vista","señora","hecho","sus")

discursos = discursos %>% 
  filter(!word %in% stopwords("spanish")) %>% 
  filter(!word %in% add.stops)

discursos_tfidf = discursos %>% 
  bind_tf_idf(word, docid, n) %>% 
  arrange(desc(tf_idf))

discursos_tfidf %>% arrange(desc(n))
```
```{r plots words, message=FALSE, warning=FALSE}
discursos_tfidf %>% 
  group_by(docid) %>% 
  top_n(3) %>% 
  ungroup() %>% 
  arrange(docid) %>% 
  ggplot(aes(word,tf_idf, color=docid)) + 
    geom_label_repel(aes(label=word)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    theme(legend.position="bottom")
```
```{r tidy bigrams}
discursos_bigram = discursos_raw %>%     
  unnest_tokens(bigram, text, token = "ngrams", n = 2) %>% 
  count(docid, bigram, sort = TRUE) %>%
  ungroup() %>% 
  bind_tf_idf(bigram, docid, n) %>% 
  arrange(desc(tf_idf))

discursos_bigram
```
```{r plots bigrams, message=FALSE, warning=FALSE}
discursos_bigram %>% 
  group_by(docid) %>% 
  top_n(3) %>% 
  ungroup() %>% 
  arrange(docid) %>% 
  ggplot(aes(bigram,tf_idf, color=docid)) + 
    geom_label_repel(aes(label=bigram)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    theme(legend.position="bottom")
```
